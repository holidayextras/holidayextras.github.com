{% assign events = site.data.speaking | sort: "date" %}
{% assign todayFormatted = site.time | date: '%Y-%m-%d' %}
{% assign speakers = site.pages | where: "category","speaker" %}

<hr />
<section>
  <h2>Upcoming Talks</h2>
  <ul>
    {% for event in events %}
      {% if event.date <= todayFormatted %}{% continue %}{% endif %}
      {% assign url = speakers | where:"title",event.speaker | map: "url" %}
      <li>
        <div class="event-logo">
          <img src="{{ site.url }}{{ site.baseurl }}/assets/img/events/{{ event.logo }}" alt="{{ event.name }}" />
        </div>
        <div>
          <h3>{{ event.talk }}</h3>
          <h4>
            {% if url.size > 0 %}
              <a href="{{ site.url }}{{ site.baseurl }}/profiles/{{ url }}" title="View {{ event.speaker }}'s Profile'">{{ event.speaker }}</a>
            {% else %}
              {{ event.speaker }}
            {% endif %}
          </h4>
          <div class="event-meta">
            <div class="date"><i class="fa fa-fw fa-calendar"></i> {{ event.pretty_date }}</div>
            <div class="location"><i class="fa fa-fw fa-location-arrow"></i> {{ event.location }}</div>
            {% if event.link %}<div class="website"><i class="fa fa-fw fa-globe"></i> <a href="{{ event.link }}" title="Visit the website for {{ event.name }}" target="_blank">Website</a></div>{% endif %}
          </div>
        </div>
      </li>
    {% endfor %}
  </ul>
</section>

<section>
  <h2>Past Talks</h2>
  <ul>
    {% for event in events reversed %}
      {% if event.date > todayFormatted %}{% continue %}{% endif %}
      {% assign url = speakers | where:"title",event.speaker | map: "url" %}
      <li>
        <h3>
          {{ event.talk }} -
          {% if url.size > 0 %}
            <a href="{{ site.url }}{{ site.baseurl }}/profiles/{{ url }}" title="View {{ event.speaker }}'s Profile'">{{ event.speaker }}</a>
          {% else %}
            {{ event.speaker }}
          {% endif %}
        </h3>
        <p style="font-size:0.83em;">
          <strong>
          {% if event.link %}<a href="{{ event.link }}" title="Visit the website for {{ event.name }}" target="_blank">{% endif %}
          {{ event.name }}
          {% if event.link %}</a>{% endif %}
          </strong>
          <br />
          <em>{{ event.pretty_date }} - {{ event.location }}</em>
        </p>
      </li>
    {% endfor %}
  </ul>
</section>
